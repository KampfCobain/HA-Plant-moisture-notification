blueprint:
  name: PflanzenÃ¼berwachung (Moisture + DÃ¼nger, Pushover)
  description: Ãœberwacht ausgewÃ¤hlte Pflanzen auf niedrige Feuchtigkeit bzw. LeitfÃ¤higkeit und benachrichtigt per Pushover.
  domain: automation
  input:
    plants:
      name: Pflanzen
      description: WÃ¤hle die Pflanzen (plant.*), die Ã¼berwacht werden sollen
      selector:
        entity:
          domain: plant
          multiple: true
    time:
      name: Zeitpunkt der tÃ¤glichen PrÃ¼fung
      default: "20:00:00"
      selector:
        time: {}
    pushover_service:
      name: Pushover Service
      description: Name des Notify-Services (z. B. notify.pushover oder notify.dein_user)
      default: notify.pushover
      selector:
        text: {}

variables:
  plants: !input plants

trigger:
  - platform: time
    at: !input time

action:
  - variables:
      water: >-
        {% set low = [] %}
        {% for entity_id in plants %}
          {% set e = states[entity_id] %}
          {% if e is not none and e.attributes.moisture_status is defined and e.attributes.moisture_status == 'Low' %}
            {% set low = low + [ e.name ] %}
          {% endif %}
        {% endfor %}
        {{ low | join(', ') }}

      nutrition: >-
        {% set low = [] %}
        {% for entity_id in plants %}
          {% set e = states[entity_id] %}
          {% if e is not none and e.attributes.conductivity_status is defined and e.attributes.conductivity_status == 'Low' %}
            {% set low = low + [ e.name ] %}
          {% endif %}
        {% endfor %}
        {{ low | join(', ') }}

  - condition: or
    conditions:
      - "{{ water != '' }}"
      - "{{ nutrition != '' }}"

  - service: !input pushover_service
    data:
      title: "Pflanzen-Check"
      message: >-
        {% if water != '' %}ðŸ’§ Braucht Wasser: {{ water }}{% endif %}
        {% if nutrition != '' %}\nðŸŒ± Braucht DÃ¼nger: {{ nutrition }}{% endif %}

mode: single
