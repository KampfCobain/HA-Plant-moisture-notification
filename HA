blueprint:
  name: PflanzenÃ¼berwachung (Moisture + DÃ¼nger, Pushover)
  description: Ãœberwacht ausgewÃ¤hlte Pflanzen auf Feuchtigkeit und DÃ¼nger, sendet Benachrichtigung via Pushover
  domain: automation
  input:
    plants:
      name: Pflanzen
      description: WÃ¤hle die Pflanzen, die Ã¼berwacht werden sollen
      selector:
        target:
          entity:
            domain: plant
            multiple: true
    time:
      name: Zeitpunkt der tÃ¤glichen PrÃ¼fung
      default: "20:00:00"
      selector:
        time: {}
    pushover_target:
      name: Pushover Service
      description: Dein Pushover notify service (z.B. notify.pushover)
      selector:
        entity:
          domain: notify

variables:
  plants: !input plants
  pushover_target: !input pushover_target

trigger:
  - platform: time
    at: !input time

action:
  - variables:
      water: >-
        {% set low = [] %}
        {% for e in expand(plants.entity_id) %}
          {% if e.attributes.moisture_status is defined and e.attributes.moisture_status == "Low" %}
            {% set low = low + [e.name] %}
          {% endif %}
        {% endfor %}
        {{ low | join(", ") }}

      nutrition: >-
        {% set low = [] %}
        {% for e in expand(plants.entity_id) %}
          {% if e.attributes.conductivity_status is defined and e.attributes.conductivity_status == "Low" %}
            {% set low = low + [e.name] %}
          {% endif %}
        {% endfor %}
        {{ low | join(", ") }}

  - condition: or
    conditions:
      - "{{ water != '' }}"
      - "{{ nutrition != '' }}"

  - service: notify.pushover
    data:
      message: >-
        {% if water != '' %}ðŸ’§ Braucht Wasser: {{ water }}{% endif %}
        {% if nutrition != '' %}\nðŸŒ± Braucht DÃ¼nger: {{ nutrition }}{% endif %}
      title: "Pflanzen-Check"

mode: single
