blueprint:
  name: PflanzenÃ¼berwachung (Moisture + DÃ¼nger, Pushover)
  description: Ãœberwacht ausgewÃ¤hlte Pflanzen auf niedrige Bodenfeuchte (moisture) oder LeitfÃ¤higkeit (conductivity) und schickt eine Pushover-Nachricht.
  domain: automation
  input:
    plants:
      name: Pflanzen
      description: WÃ¤hle eine oder mehrere plant.* Entities aus
      selector:
        entity:
          multiple: true
          filter:
            - domain: plant

    time:
      name: Zeitpunkt der tÃ¤glichen PrÃ¼fung
      default: "20:00:00"
      selector:
        time: {}

    pushover_service:
      name: Pushover Service
      description: Notify-Service-Name, z. B. notify.pushover
      default: notify.pushover
      selector:
        text: {}

trigger:
  - platform: time
    at: !input time

action:
  - variables:
      plant_ids: !input plants

      water: >-
        {% set p = plant_ids if plant_ids is string else plant_ids %}
        {% set low = [] %}
        {% for ent in p %}
          {% set s = states[ent] %}
          {% if s is not none and s.attributes.moisture_status is defined and s.attributes.moisture_status == 'Low' %}
            {% set low = low + [ s.name ] %}
          {% endif %}
        {% endfor %}
        {{ low | join(', ') }}

      nutrition: >-
        {% set p = plant_ids if plant_ids is string else plant_ids %}
        {% set low = [] %}
        {% for ent in p %}
          {% set s = states[ent] %}
          {% if s is not none and s.attributes.conductivity_status is defined and s.attributes.conductivity_status == 'Low' %}
            {% set low = low + [ s.name ] %}
          {% endif %}
        {% endfor %}
        {{ low | join(', ') }}

  - condition: or
    conditions:
      - "{{ water != '' }}"
      - "{{ nutrition != '' }}"

  - service: !input pushover_service
    data:
      title: "Pflanzen-Check"
      message: >-
        {% if water != '' %}ðŸ’§ Braucht Wasser: {{ water }}{% endif %}
        {% if nutrition != '' %}{% if water != '' %}\n{% endif %}ðŸŒ± Braucht DÃ¼nger: {{ nutrition }}{% endif %}

mode: single
